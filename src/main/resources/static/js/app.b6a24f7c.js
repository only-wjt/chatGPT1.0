(function(e){function t(t){for(var o,i,r=t[0],u=t[1],l=t[2],d=0,f=[];d<r.length;d++)i=r[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(e[o]=u[o]);c&&c(t);while(f.length)f.shift()();return n.push.apply(n,l||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],o=!0,r=1;r<s.length;r++){var u=s[r];0!==a[u]&&(o=!1)}o&&(n.splice(t--,1),e=i(i.s=s[0]))}return e}var o={},a={app:0},n=[];function i(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=o,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(s,o,function(t){return e[t]}.bind(null,o));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],u=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var c=u;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";s("85ec")},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var o=s("2b0e"),a=s("5c96"),n=s.n(a),i=(s("0fae"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("HelloWorld")],1)}),r=[],u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"main"},[s("div",{staticClass:"main_up"},[""==e.curUserName?s("div",[s("el-button",{on:{click:function(t){return e.openDialog("登录")}}},[e._v("登录")]),s("el-button",{on:{click:function(t){return e.openDialog("注册")}}},[e._v("注册")])],1):s("div",[e._v(" "+e._s(this.curUserName)+" "),s("el-button",{attrs:{type:"info"},on:{click:e.loginOut}},[e._v("退出登录")])],1)]),s("div",{staticClass:"main_down"},[s("div",{staticClass:"left"},[s("div",{staticClass:"left_up"},[s("div",{staticClass:"label_title"},[e._v(" 已建立会话 ")]),e._l(e.sessionList_already,(function(t){return s("div",{key:t.id,class:e.curSessionId==t.id?"box_select":"box"},[s("div",{staticClass:"box_left",on:{click:function(s){return e.startSession(t.id)}}},[e._v(" "+e._s(t.listName)+" ")]),s("div",{staticClass:"right_left"},[s("div",{staticClass:"right_left_count"},[e._v(" "+e._s(t.unReadCount)+" ")]),s("div",{staticClass:"right_left_del"},[s("i",{staticClass:"el-icon-close",on:{click:function(s){return e.delSession(t.id)}}})])])])}))],2),s("div",{staticClass:"left_down"},[s("div",{staticClass:"label_title"},[e._v(" 可建立会话 ")]),e._l(e.sessionList_not,(function(t){return s("div",{key:t.id,staticClass:"box",on:{click:function(s){return e.createSession(t.id,t.name)}}},[s("div",{staticClass:"box_left"},[e._v(" "+e._s(t.name)+" ")])])}))],2)]),s("div",{staticClass:"right"},[s("div",{ref:"element",staticClass:"up",attrs:{id:"msg_end"}},e._l(e.list,(function(t,o){return s("div",{key:o,class:t.fromUserId===e.curUserId?"msg_right":"msg_left"},[s("div",{staticClass:"msg_right_up"},[e._v(" "+e._s(t.fromUserName)+" ")]),s("div",{class:t.fromUserId===e.curUserId?"msg_right_down":"msg_left_down"},[e._v(" "+e._s(t.content)+" ")])])})),0),s("div",{staticClass:"down"},[s("el-input",{attrs:{type:"textarea",rows:9,placeholder:"请输入内容，回车发送！"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMsg(t)}},model:{value:e.textarea,callback:function(t){e.textarea=t},expression:"textarea"}})],1)])]),s("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-input",{attrs:{placeholder:"请输入用户名..."},model:{value:e.loginName,callback:function(t){e.loginName=t},expression:"loginName"}}),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.loginOrRegister}},[e._v("确 定")])],1)],1)],1)},l=[],c=(s("b0c0"),s("bc3a")),d=s.n(c),f={name:"HelloWorld",data:function(){return{dialogVisible:!1,dialogTitle:"",loginName:"",textarea:"",list:[],curUserId:"",curUserName:"",sessionList_already:[],sessionList_not:[],curSessionId:""}},created:function(){},updated:function(){var e=document.getElementById("msg_end");console.log(e),e.scrollTop=e.scrollHeight},destroyed:function(){this.websocketclose()},methods:{initWebSocket:function(e,t){this.websock=new WebSocket("ws://127.0.0.1:1997/websocket/"+e+"/"+t),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose},websocketonopen:function(){console.log("WebSocket连接成功")},websocketonerror:function(e){console.log("WebSocket连接发生错误",e)},websocketonmessage:function(e){var t=JSON.parse(e.data);t instanceof Array?this.sessionList_already=t:this.list.push(t)},websocketclose:function(e){null!=this.curUserId&&(null!=this.curSessionId?this.initWebSocket(this.curUserId,this.curSessionId):this.initWebSocket(this.curUserId,99999999)),console.log("connection closed",e),console.log(e)},sendMsg:function(){if(""==this.curSessionId)return this.$message.error("请选择左边的对话框开始聊天!");var e={fromUserId:this.curUserId,fromUserName:this.curUserName,content:this.textarea};this.list.push(e),this.websock.send(this.textarea),this.textarea=""},openDialog:function(e){this.dialogTitle=e,this.dialogVisible=!0},loginOrRegister:function(){var e=this;"注册"==this.dialogTitle?d.a.get("http://127.0.0.1:1997/register?name="+this.loginName).then((function(t){if(-1==t.data.code)return e.$message.error(t.data.errDesc);e.$message.success("注册成功"),e.dialogVisible=!1})).catch((function(e){console.log(e)})):"登录"==this.dialogTitle&&d.a.get("http://127.0.0.1:1997/login?name="+this.loginName).then((function(t){if(console.log(t.data),-1==t.data.code)return e.$message.error(t.data.errDesc);e.curUserId=t.data.data.id,e.curUserName=t.data.data.name,e.dialogVisible=!1,e.getSessionListNot(),e.sessionListAlready(),e.startSession(99999999)})).catch((function(e){console.log(e)}))},getSessionListNot:function(){var e=this;d.a.get("http://127.0.0.1:1997/sessionList/not?id="+this.curUserId).then((function(t){if(-1==t.data.code)return e.$message.error(t.data.errDesc);e.sessionList_not=t.data.data})).catch((function(e){console.log(e)}))},sessionListAlready:function(){var e=this;d.a.get("http://127.0.0.1:1997/sessionList/already?id="+this.curUserId).then((function(t){if(-1==t.data.code)return e.$message.error(t.data.errDesc);e.sessionList_already=t.data.data})).catch((function(e){console.log(e)}))},createSession:function(e,t){var s=this;d.a.get("http://127.0.0.1:1997/createSession?id="+this.curUserId+"&toUserId="+e+"&toUserName="+t).then((function(e){if(-1==e.data.code)return s.$message.error(e.data.errDesc);s.getSessionListNot(),s.sessionListAlready()})).catch((function(e){console.log(e)}))},startSession:function(e){console.log(this.websock),void 0!=this.websock&&this.websock.close(),this.curSessionId=e,this.initWebSocket(this.curUserId,e),this.msgList(e)},delSession:function(e){var t=this;d.a.get("http://127.0.0.1:1997/delSession?sessionId="+e).then((function(e){if(-1==e.data.code)return t.$message.error(e.data.errDesc);t.getSessionListNot(),t.sessionListAlready()})).catch((function(e){console.log(e)}))},loginOut:function(){var e=this;d.a.get("http://127.0.0.1:1997/loginOut?name="+this.curUserName).then((function(t){return-1==t.data.code?e.$message.error(t.data.errDesc):(e.curUserId="",e.curUserName="",e.$message.success("退出登录成功"))})).catch((function(e){console.log(e)}))},msgList:function(e){var t=this;d.a.get("http://127.0.0.1:1997/msgList?sessionId="+e).then((function(e){if(-1==e.data.code)return t.$message.error(e.data.errDesc);t.list=e.data.data,t.sessionListAlready()})).catch((function(e){console.log(e)}))}}},p=f,g=(s("c373"),s("2877")),h=Object(g["a"])(p,u,l,!1,null,"10b0cd01",null),m=h.exports,b={name:"App",components:{HelloWorld:m}},v=b,_=(s("034f"),Object(g["a"])(v,i,r,!1,null,null,null)),k=_.exports;o["default"].use(n.a),o["default"].use(a["Pagination"]),o["default"].use(a["Dialog"]),o["default"].use(a["Autocomplete"]),o["default"].use(a["Dropdown"]),o["default"].use(a["DropdownMenu"]),o["default"].use(a["DropdownItem"]),o["default"].use(a["Menu"]),o["default"].use(a["Submenu"]),o["default"].use(a["MenuItem"]),o["default"].use(a["MenuItemGroup"]),o["default"].use(a["Input"]),o["default"].use(a["InputNumber"]),o["default"].use(a["Radio"]),o["default"].use(a["RadioGroup"]),o["default"].use(a["RadioButton"]),o["default"].use(a["Checkbox"]),o["default"].use(a["CheckboxButton"]),o["default"].use(a["CheckboxGroup"]),o["default"].use(a["Switch"]),o["default"].use(a["Select"]),o["default"].use(a["Option"]),o["default"].use(a["OptionGroup"]),o["default"].use(a["Button"]),o["default"].use(a["ButtonGroup"]),o["default"].use(a["Table"]),o["default"].use(a["TableColumn"]),o["default"].use(a["DatePicker"]),o["default"].use(a["TimeSelect"]),o["default"].use(a["TimePicker"]),o["default"].use(a["Popover"]),o["default"].use(a["Tooltip"]),o["default"].use(a["Breadcrumb"]),o["default"].use(a["BreadcrumbItem"]),o["default"].use(a["Form"]),o["default"].use(a["FormItem"]),o["default"].use(a["Tabs"]),o["default"].use(a["TabPane"]),o["default"].use(a["Tag"]),o["default"].use(a["Tree"]),o["default"].use(a["Alert"]),o["default"].use(a["Slider"]),o["default"].use(a["Icon"]),o["default"].use(a["Row"]),o["default"].use(a["Col"]),o["default"].use(a["Upload"]),o["default"].use(a["Progress"]),o["default"].use(a["Spinner"]),o["default"].use(a["Badge"]),o["default"].use(a["Card"]),o["default"].use(a["Rate"]),o["default"].use(a["Steps"]),o["default"].use(a["Step"]),o["default"].use(a["Carousel"]),o["default"].use(a["CarouselItem"]),o["default"].use(a["Collapse"]),o["default"].use(a["CollapseItem"]),o["default"].use(a["Cascader"]),o["default"].use(a["ColorPicker"]),o["default"].use(a["Transfer"]),o["default"].use(a["Container"]),o["default"].use(a["Header"]),o["default"].use(a["Aside"]),o["default"].use(a["Main"]),o["default"].use(a["Footer"]),o["default"].use(a["Timeline"]),o["default"].use(a["TimelineItem"]),o["default"].use(a["Link"]),o["default"].use(a["Divider"]),o["default"].use(a["Image"]),o["default"].use(a["Calendar"]),o["default"].use(a["Backtop"]),o["default"].use(a["PageHeader"]),o["default"].use(a["CascaderPanel"]),o["default"].use(a["Loading"].directive),o["default"].prototype.$loading=a["Loading"].service,o["default"].prototype.$msgbox=a["MessageBox"],o["default"].prototype.$alert=a["MessageBox"].alert,o["default"].prototype.$confirm=a["MessageBox"].confirm,o["default"].prototype.$prompt=a["MessageBox"].prompt,o["default"].prototype.$notify=a["Notification"],o["default"].prototype.$message=a["Message"],o["default"].config.productionTip=!1,new o["default"]({render:function(e){return e(k)}}).$mount("#app")},"58ad":function(e,t,s){},"85ec":function(e,t,s){},c373:function(e,t,s){"use strict";s("58ad")}});
//# sourceMappingURL=app.b6a24f7c.js.map